{% extends 'base.twig' %}

{% block title %}لیست دفاتر ترجمه رسمی{% endblock %}
{% block scripts %}
<script type="text/javascript">
	$(document).ready(function(){  
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position){
				//var loc=position.coords.latitude+","+position.coords.longitude;
				var loc="35.735766,51.429760";
				var data={
					query:{
						geo_distance:{
							distance:"200km",
							loc:loc
						}
					},
					sort : [
						{
							_geo_distance : {
								loc : loc,
								order : "asc",
								unit : "km",
								mode : "min",
								distance_type : "arc",
								ignore_unmapped: true
							}
						}
					]
				};
				fetch("https://first-cluster-6104576857.us-east-1.bonsaisearch.net:443/_search?size=5",{
					method:"post",
					headers: {
							"Authorization": "Basic NmI5bzlsOWg3NDp5cWVnbnpkY2N2",
							"Content-Type": "application/json"
					},
					body: JSON.stringify(data)
				})
				.then(res=>res.json())
				.then(
					(result) => {
                                            debugger
						var list= result.hits.hits.map(function(item){
							return item["_source"];
						});
						$("#centerList").html("");
						for(var i=0;i<list.length;i++){
							var item=$('<a href="#" class="list-group-item list-group-item-action flex-column align-items-start"><div class="d-flex w-100 justify-content-between"><h6 class="mb-1">دفتر ترجمه رسمی شماره '+list[i].code+' '+list[i].city+'</h6><small style="color: #00469c">'+list[i].manager+'</small></div><small class="mb-1">'+list[i].address+'</small><small>'+list[i].phone+'</small></a>');
							$("#centerList").append(item);
						}
                                                $(".list-group-item").first().addClass("active");
                                                $(".list-group-item").click(function (){
                                                    $(".list-group-item").removeClass("active");
                                                    $(this).addClass("active");
                                                });

					},
					(error) => {
						
					}
				);
			});
		} 
                
                
	});
        
</script>
{% endblock %}


{% block content %}
<div class="stepper">
  <div class="circle done"> <span class="label">1</span>
    <span class="title">انتخاب مدارک</span>

  </div> <span class="bar done"></span>

  <div class="circle done"> <span class="label">2</span>
    <span class="title"> پیوست مدارک</span>

  </div> <span class="bar done"></span>

  <div class="circle done"> <span class="label">3</span>
    <span class="title">تعیین آدرس</span>

  </div> <span class="bar done"></span>

  <div class="circle active"> <span class="label">4</span>
    <span class="title">انتخاب دفتر ترجمه</span>

  </div> <span class="bar active"></span>

  <div class="circle"> <span class="label">5</span>
    <span class="title">صورتحساب</span>

  </div>
</div>

<div class="container mainContainer">
	<div id="geoHeader" class="row">
		<div class="col-sm-12">
			نزدیک ترین دفاتر ترجمه رسمی به شما
		</div>
	</div>
	<div class="row">
		<div id="centerList" class="list-group" style="width: 100%;direction: rtl;">
		</div>
	</div>
</div>
<a href="صورتحساب"> <div class="btn btn-primary topButton" style="margin-top:10px;">ادامه</div></a>
{% endblock %}
